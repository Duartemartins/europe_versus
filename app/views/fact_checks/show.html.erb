<% content_for(:title) { "#{@fact_check.title} — EUROPEVERSUS Fact Check" } %>

<%# Open Graph & Twitter Card Meta Tags %>
<% content_for :head do %>
  <!-- Open Graph -->
  <meta property="og:title" content="<%= @fact_check.title %>">
  <meta property="og:description" content="<%= @fact_check.og_description || @fact_check.subtitle %>">
  <meta property="og:image" content="<%= fact_check_image_url(slug: @fact_check.slug) %>">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="article">
  <meta property="og:url" content="<%= fact_check_url(slug: @fact_check.slug) %>">
  <meta property="og:site_name" content="EUROPEVERSUS">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= @fact_check.title %>">
  <meta name="twitter:description" content="<%= @fact_check.og_description || @fact_check.subtitle %>">
  <meta name="twitter:image" content="<%= fact_check_image_url(slug: @fact_check.slug) %>">
<% end %>

<div class="max-w-7xl mx-auto px-4 md:px-6">
  <!-- Floating Share Sidebar (Desktop) -->
  <aside class="hidden lg:block fixed left-8 top-1/2 -translate-y-1/2 z-50" data-controller="share-sidebar">
    <div class="flex flex-col gap-3 p-3 bg-white border-2 border-black shadow-[4px_4px_0_0_#000]">
      <span class="font-mono text-[10px] uppercase tracking-brutal text-black/50 text-center">Share</span>
      
      <!-- Twitter/X -->
      <a href="https://twitter.com/intent/tweet?text=<%= CGI.escape("#{@fact_check.title}") %>&url=<%= CGI.escape(fact_check_url(slug: @fact_check.slug)) %>"
         target="_blank"
         rel="noopener noreferrer"
         class="w-10 h-10 flex items-center justify-center border-2 border-black hover:bg-black hover:text-white transition-colors"
         title="Share on X">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </a>

      <!-- LinkedIn -->
      <a href="https://www.linkedin.com/sharing/share-offsite/?url=<%= CGI.escape(fact_check_url(slug: @fact_check.slug)) %>"
         target="_blank"
         rel="noopener noreferrer"
         class="w-10 h-10 flex items-center justify-center border-2 border-black hover:bg-[#0077B5] hover:border-[#0077B5] hover:text-white transition-colors"
         title="Share on LinkedIn">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
      </a>

      <!-- Facebook -->
      <a href="https://www.facebook.com/sharer/sharer.php?u=<%= CGI.escape(fact_check_url(slug: @fact_check.slug)) %>"
         target="_blank"
         rel="noopener noreferrer"
         class="w-10 h-10 flex items-center justify-center border-2 border-black hover:bg-[#1877F2] hover:border-[#1877F2] hover:text-white transition-colors"
         title="Share on Facebook">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
      </a>

      <!-- Copy Link -->
      <button onclick="copyArticleUrl()" 
              class="w-10 h-10 flex items-center justify-center border-2 border-black hover:bg-[#0066FF] hover:border-[#0066FF] hover:text-white transition-colors"
              title="Copy link">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
      </button>
    </div>
  </aside>

  <article class="max-w-3xl mx-auto py-8 md:py-12">
    <!-- Breadcrumb -->
    <nav class="mb-6 md:mb-8">
      <%= link_to facts_path, class: "font-mono text-xs uppercase tracking-brutal text-black/60 hover:text-[#0066FF] transition-colors" do %>
        ← All Fact Checks
      <% end %>
    </nav>

    <!-- Article Header -->
    <header class="border-b-4 border-black pb-8 mb-10">
      <span class="font-mono text-xs uppercase tracking-brutal bg-[#0066FF] text-white px-3 py-1 inline-block mb-6">
        Fact Check
      </span>
      
      <h1 class="text-3xl md:text-5xl lg:text-6xl font-black tracking-tight mb-4 leading-tight">
        <%= @fact_check.title %>
      </h1>
      
      <% if @fact_check.subtitle %>
        <p class="text-xl md:text-2xl text-black/70 italic mb-6 leading-relaxed">
          "<%= @fact_check.subtitle %>"
        </p>
      <% end %>

      <!-- Meta info -->
      <div class="flex flex-wrap items-center gap-4 text-sm text-black/60">
        <% if @fact_check.created_at %>
          <span class="font-mono">
            Published <%= @fact_check.created_at.strftime("%B %d, %Y") %>
          </span>
        <% end %>
        <span class="font-mono">
          <%= @fact_check.metrics.size %> data points
        </span>
      </div>
    </header>

    <!-- Article Body with improved typography -->
    <div class="fact-check-content">
      <%= @fact_check.render_html(self) %>
    </div>

    <!-- Mobile Share Buttons -->
    <div class="lg:hidden border-t-2 border-black mt-10 pt-6">
      <h3 class="font-mono text-xs uppercase tracking-brutal font-bold mb-4">Share this article</h3>
      <div class="flex flex-wrap gap-2">
        <a href="https://twitter.com/intent/tweet?text=<%= CGI.escape("#{@fact_check.title}") %>&url=<%= CGI.escape(fact_check_url(slug: @fact_check.slug)) %>"
           target="_blank"
           rel="noopener noreferrer"
           class="inline-flex items-center gap-2 px-4 py-2 border-2 border-black font-mono text-xs uppercase tracking-brutal hover:bg-black hover:text-white transition-colors">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          X
        </a>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=<%= CGI.escape(fact_check_url(slug: @fact_check.slug)) %>"
           target="_blank"
           rel="noopener noreferrer"
           class="inline-flex items-center gap-2 px-4 py-2 border-2 border-black font-mono text-xs uppercase tracking-brutal hover:bg-black hover:text-white transition-colors">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          LinkedIn
        </a>
        <button onclick="copyArticleUrl()" 
                class="inline-flex items-center gap-2 px-4 py-2 border-2 border-black font-mono text-xs uppercase tracking-brutal hover:bg-black hover:text-white transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          <span id="copy-url-text">Copy</span>
        </button>
      </div>
    </div>

    <!-- Article Footer -->
    <footer class="border-t-4 border-black mt-10 pt-8">
      <!-- Related Statistics -->
      <% if @fact_check.metrics.any? %>
        <div class="mb-8">
          <h3 class="font-mono text-xs uppercase tracking-brutal font-bold mb-4">Explore the data</h3>
          <div class="flex flex-wrap gap-2">
            <% @fact_check.metrics.each do |metric| %>
              <%= link_to statistic_path(metric.tr("_", "-")), 
                  class: "inline-flex items-center gap-1 px-3 py-2 border border-black/20 font-mono text-xs hover:border-black hover:bg-[#F5F5F5] transition-colors" do %>
                <%= metric.tr("_", " ").titleize %>
                <span class="text-black/40">→</span>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Back to all -->
      <%= link_to facts_path, class: "inline-flex items-center gap-2 font-mono text-sm uppercase tracking-brutal border-2 border-black px-6 py-3 hover:bg-black hover:text-white transition-colors" do %>
        ← All Fact Checks
      <% end %>
    </footer>
  </article>
</div>

<!-- Improved Typography Styles -->
<style>
  .fact-check-content {
    font-size: 1.125rem;
    line-height: 1.8;
    color: #1a1a1a;
  }
  
  .fact-check-content h2 {
    font-size: 1.875rem;
    font-weight: 900;
    letter-spacing: -0.025em;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid #000;
  }
  
  .fact-check-content h3 {
    font-size: 1.5rem;
    font-weight: 800;
    letter-spacing: -0.025em;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  .fact-check-content p {
    margin-bottom: 1.5rem;
    color: rgba(0, 0, 0, 0.85);
  }
  
  .fact-check-content strong {
    font-weight: 700;
    color: #000;
  }
  
  .fact-check-content em {
    font-style: italic;
  }
  
  .fact-check-content a:not(.not-prose a) {
    color: #0066FF;
    text-decoration: none;
    border-bottom: 1px solid #0066FF;
    transition: border-color 0.2s;
  }
  
  .fact-check-content a:not(.not-prose a):hover {
    border-bottom-width: 2px;
  }
  
  .fact-check-content blockquote {
    border-left: 4px solid #0066FF;
    background: rgba(0, 102, 255, 0.05);
    padding: 1.5rem;
    margin: 2rem 0;
    font-style: normal;
  }
  
  .fact-check-content blockquote p {
    margin-bottom: 0;
  }
  
  .fact-check-content ul,
  .fact-check-content ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }
  
  .fact-check-content ul {
    list-style-type: disc;
  }
  
  .fact-check-content ol {
    list-style-type: decimal;
  }
  
  .fact-check-content li {
    margin-bottom: 0.5rem;
    padding-left: 0.5rem;
  }
  
  .fact-check-content li::marker {
    color: #0066FF;
    font-weight: bold;
  }
  
  .fact-check-content code {
    font-family: 'Space Mono', monospace;
    background: #F5F5F5;
    padding: 0.125rem 0.375rem;
    border-radius: 0;
    font-size: 0.875em;
  }
  
  .fact-check-content hr {
    border: none;
    border-top: 2px solid #000;
    margin: 3rem 0;
  }
  
  @media (min-width: 768px) {
    .fact-check-content h2 {
      font-size: 2.25rem;
    }
    
    .fact-check-content h3 {
      font-size: 1.75rem;
    }
  }
</style>

<script>
  function copyArticleUrl() {
    const url = '<%= fact_check_url(slug: @fact_check.slug) %>';
    navigator.clipboard.writeText(url).then(() => {
      const btn = document.getElementById('copy-url-text');
      if (btn) {
        btn.textContent = 'Copied!';
        setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
      }
    });
  }
</script>
