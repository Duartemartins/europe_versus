<% show_current_values = local_assigns.fetch(:show_current_values, true); compact_view = local_assigns.fetch(:compact_view, false); nil %>
<section class="<%= compact_view ? 'py-12' : 'py-20' %> border-t-2 border-black">
  <div class="max-w-6xl mx-auto">
    <div class="mb-12">
      <h2 class="<%= compact_view ? 'text-3xl' : 'text-5xl' %> font-black tracking-tighter mb-4">
        HOW EUROPE<br>
        <span class="text-[#0066FF]">IS DEFINED</span>
      </h2>
      <p class="<%= compact_view ? 'text-base' : 'text-lg' %> text-black/60 max-w-2xl">
        Transparent, population-weighted calculations for fair comparisons
      </p>
    </div>
    
    <div class="grid md:grid-cols-2 gap-0">
      <!-- Population Calculation -->
      <div class="border-2 border-black p-8">
        <div class="flex items-center gap-4 mb-6 pb-6 border-b border-black">
          <span class="font-mono text-xs uppercase tracking-brutal bg-black text-white px-3 py-1">01</span>
          <h3 class="font-mono text-sm uppercase tracking-brutal font-bold">Population</h3>
        </div>
        <div class="space-y-4">
          <p class="text-black/70">Europe includes all 50 European countries:</p>
          <ul class="space-y-2 text-sm text-black/60">
            <li class="flex items-start gap-2">
              <span class="text-[#0066FF] font-bold">—</span>
              <span><strong class="text-black">27 EU member states:</strong> Germany, France, Italy, etc.</span>
            </li>
            <% unless compact_view %>
              <li class="flex items-start gap-2">
                <span class="text-[#0066FF] font-bold">—</span>
                <span><strong class="text-black">Non-EU European:</strong> UK, Switzerland, Norway, Ukraine</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[#0066FF] font-bold">—</span>
                <span><strong class="text-black">Transcontinental:</strong> Russia and Turkey</span>
              </li>
            <% else %>
              <li class="flex items-start gap-2">
                <span class="text-[#0066FF] font-bold">—</span>
                <span><strong class="text-black">Other European:</strong> UK, Switzerland, Norway, etc.</span>
              </li>
            <% end %>
          </ul>
        </div>
        <% if show_current_values %>
          <% 
            begin
              population_data = PopulationDataService.latest_population_for_countries(['europe'])
              if population_data && population_data['europe']
          %>
            <div class="mt-6 pt-6 border-t border-black">
              <div class="font-mono text-xs uppercase tracking-brutal text-black/50 mb-2">Current Total</div>
              <div class="font-mono text-3xl font-bold text-[#0066FF]">
                <%= number_with_delimiter(population_data['europe'][:value].to_i / 1_000_000) %>M
              </div>
              <div class="font-mono text-xs text-black/40"><%= population_data['europe'][:year] %></div>
            </div>
          <% 
              end
            rescue => e
            end
          %>
        <% end %>
      </div>
      
      <!-- GDP Calculation -->
      <div class="border-2 border-black border-l-0 p-8">
        <div class="flex items-center gap-4 mb-6 pb-6 border-b border-black">
          <span class="font-mono text-xs uppercase tracking-brutal bg-black text-white px-3 py-1">02</span>
          <h3 class="font-mono text-sm uppercase tracking-brutal font-bold">GDP per Capita</h3>
        </div>
        <div class="space-y-4">
          <p class="text-black/70">Population-weighted calculation:</p>
          <ul class="space-y-2 text-sm text-black/60">
            <li class="flex items-start gap-2">
              <span class="text-[#0066FF] font-bold">—</span>
              <span><strong class="text-black">Step 1:</strong> GDP × population = total GDP</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-[#0066FF] font-bold">—</span>
              <span><strong class="text-black">Step 2:</strong> Sum all countries' total GDP</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-[#0066FF] font-bold">—</span>
              <span><strong class="text-black">Step 3:</strong> Divide by total population</span>
            </li>
            <% unless compact_view %>
              <li class="flex items-start gap-2">
                <span class="text-[#0066FF] font-bold">—</span>
                <span><strong class="text-black">Coverage:</strong> 49 countries (98%)</span>
              </li>
            <% end %>
          </ul>
        </div>
        <% if show_current_values %>
          <% 
            begin
              gdp_data = EuropeanMetricsService.latest_metric_for_countries('gdp_per_capita_ppp', ['europe'])
              if gdp_data && gdp_data['europe']
          %>
            <div class="mt-6 pt-6 border-t border-black">
              <div class="font-mono text-xs uppercase tracking-brutal text-black/50 mb-2">GDP per Capita PPP</div>
              <div class="font-mono text-3xl font-bold text-[#0066FF]">
                $<%= number_with_delimiter(gdp_data['europe'][:value].to_i) %>
              </div>
              <div class="font-mono text-xs text-black/40"><%= gdp_data['europe'][:year] %></div>
            </div>
          <% 
              end
            rescue => e
            end
          %>
        <% end %>
      </div>
    </div>
    
    <% if compact_view %>
      <div class="mt-8">
        <%= link_to methodology_path, class: "inline-flex items-center gap-4 bg-black text-white px-8 py-4 font-mono text-sm uppercase tracking-brutal hover:bg-[#0066FF] transition-colors" do %>
          Full Methodology
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        <% end %>
      </div>
    <% else %>
      <div class="mt-8 p-6 border-2 border-black bg-[#F5F5F5]">
        <div class="flex items-center gap-4">
          <svg class="w-5 h-5 text-[#0066FF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="font-mono text-sm">
            This provides a comprehensive comparison with USA, China, and India
          </span>
        </div>
      </div>
    <% end %>
  </div>
</section>
